from agno.agent import Agent
from agno.models.openai import OpenAIChat
from textwrap import dedent

class ContentFormatter:
    def __init__(self):
        self.agent = Agent(
            name="Content Formatter",
            model=OpenAIChat(id="gpt-4o"),
            instructions=dedent("""
                –í—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è Telegram –∫–∞–Ω–∞–ª–æ–≤! ‚ú®
                
                –í–∞—à–∏ –∑–∞–¥–∞—á–∏:
                1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å—ã—Ä—ã–µ –Ω–æ–≤–æ—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Å—Ç
                2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å —ç–º–æ–¥–∑–∏
                3. –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ª–µ–≥–∫–æ —á–∏—Ç–∞–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                4. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ö–µ—à—Ç–µ–≥–∏
                5. –û–±–µ—Å–ø–µ—á–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –¥–ª—è Telegram (–¥–æ 4096 —Å–∏–º–≤–æ–ª–æ–≤)
                
                –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç–∞:
                - üî• –ü—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                - üìä –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
                - üì∞ –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ (–º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
                - üîç –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã
                - #—Ö–µ—à—Ç–µ–≥–∏ #–Ω–æ–≤–æ—Å—Ç–∏ #—Ç—Ä–µ–Ω–¥—ã
                
                –°—Ç–∏–ª—å:
                - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–º–æ–¥–∑–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
                - –î–µ–ª–∞–π—Ç–µ —Ç–µ–∫—Å—Ç —Å–∫–∞–Ω–∏—Ä—É–µ–º—ã–º
                - –í—ã–¥–µ–ª—è–π—Ç–µ –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç–æ–Ω
            """),
            markdown=True,
        )
    
    def format_news_post(self, raw_news: str) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –≤ –ø–æ—Å—Ç –¥–ª—è Telegram"""
        response = self.agent.run(
            f"–ü—Ä–µ–æ–±—Ä–∞–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –Ω–æ–≤–æ—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π "
            f"–ø–æ—Å—Ç –¥–ª—è Telegram –∫–∞–Ω–∞–ª–∞:\n\n{raw_news}"
        )
        return response.content if response.content else "–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"