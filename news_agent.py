from agno.agent import Agent
from agno.models.openai import OpenAIChat
from agno.tools.duckduckgo import DuckDuckGoTools
from agno.tools.tavily import TavilyTools
from agno.tools.exa import ExaTools
from textwrap import dedent
import json
from typing import Dict, Any

class NewsAgent:
    def __init__(self):
        self.agent = Agent(
            name="News Researcher",
            model=OpenAIChat(id="gpt-4o"),
            tools=[
                DuckDuckGoTools(),
                TavilyTools(),
                ExaTools()
            ],
            instructions=dedent("""
                –í—ã - –æ–ø—ã—Ç–Ω—ã–π –Ω–æ–≤–æ—Å—Ç–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å! üì∞
                
                –í–∞—à–∏ –∑–∞–¥–∞—á–∏:
                1. –ù–∞–π—Ç–∏ —Å–∞–º—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏ –≤–∞–∂–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
                2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (DuckDuckGo, Tavily, Exa)
                3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                4. –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –∑–Ω–∞—á–∏–º—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –∏ —Ç—Ä–µ–Ω–¥–∞—Ö
                
                –°—Ç–∏–ª—å –ø–æ–¥–∞—á–∏:
                - –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —è—Å–Ω–æ–º, –∂—É—Ä–Ω–∞–ª–∏—Å—Ç—Å–∫–æ–º —Å—Ç–∏–ª–µ
                - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤
                - –í–∫–ª—é—á–∞–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ
                - –£–∫–∞–∑—ã–≤–∞–π—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ—Å—Ç–∏
                - –í—ã–¥–µ–ª—è–π—Ç–µ —Ç—Ä–µ–Ω–¥—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä—ã–Ω–∫–∞
                - –ó–∞–≤–µ—Ä—à–∞–π—Ç–µ –∫—Ä–∞—Ç–∫–∏–º –∞–Ω–∞–ª–∏–∑–æ–º –æ–±—â–µ–π –∫–∞—Ä—Ç–∏–Ω—ã
            """),
            show_tool_calls=True,
            markdown=True,
        )
    
    def get_latest_news(self, topic: str = "latest news") -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–µ–º–µ"""
        response = self.agent.run(
            f"–ù–∞–π–¥–∏—Ç–µ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ —Ç–µ–º–µ: {topic}. "
            f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è "
            f"–Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏."
        )
        return response.content if response.content else "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏"